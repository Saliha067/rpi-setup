server {
  listen {{ ollama_nginx_port }};

  # --- IP allowlist ---
{% for cidr in ollama_nginx_allow_cidrs %}
  allow {{ cidr }};
{% endfor %}
  deny all;

  # --- Basic auth ---
  # auth_basic "Ollama";
  # auth_basic_user_file {{ ollama_nginx_htpasswd_path }};

  # --- Proxy to local Ollama only ---
  location / {
    proxy_pass http://127.0.0.1:11434;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header Connection "";
    proxy_buffering off;

    proxy_connect_timeout 600s;
    proxy_send_timeout 600s;
    proxy_read_timeout 600s;
    send_timeout 600s;
  }
}
